<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/></head><body><!DOCTYPE html><br><html lang="ar" dir="rtl"><br><head><br>    <meta charset="UTF-8"><br>    <meta name="viewport" content="width=device-width, initial-scale=1.0"><br>    <title>السجل المهاري التطوعي</title><br>    <script src="https://cdn.tailwindcss.com"></script><br>    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"><br>    <br>    <!-- Firebase SDK --><br>    <script type="module"><br>        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';<br>        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, query, where, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';<br>        <br>        // إعدادات Firebase - يجب استبدالها بإعداداتك<br>        const firebaseConfig = {<br>            apiKey: "YOUR_API_KEY_HERE",<br>            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",<br>            projectId: "YOUR_PROJECT_ID",<br>            storageBucket: "YOUR_PROJECT_ID.appspot.com",<br>            messagingSenderId: "YOUR_SENDER_ID",<br>            appId: "YOUR_APP_ID"<br>        };<br><br>        // تهيئة Firebase<br>        const app = initializeApp(firebaseConfig);<br>        const db = getFirestore(app);<br>        <br>        // جعل Firebase متاح عالمياً<br>        window.db = db;<br>        window.firestore = { collection, addDoc, getDocs, doc, updateDoc, query, where, orderBy };<br>    </script><br>    <br>    <style><br>        body {<br>            box-sizing: border-box;<br>            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;<br>        }<br>        .gradient-bg {<br>            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);<br>        }<br>        .card-shadow {<br>            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);<br>        }<br>        .btn-primary {<br>            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);<br>            transition: all 0.3s ease;<br>        }<br>        .btn-primary:hover {<br>            transform: translateY(-2px);<br>            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);<br>        }<br>        @media print {<br>            .no-print { display: none !important; }<br>            .print-section { page-break-inside: avoid; }<br>        }<br>        .skill-item {<br>            border: 2px solid #e5e7eb;<br>            border-radius: 8px;<br>            padding: 12px;<br>            margin: 8px 0;<br>            background: #f9fafb;<br>        }<br>        .firebase-status {<br>            position: fixed;<br>            top: 20px;<br>            left: 20px;<br>            padding: 8px 16px;<br>            border-radius: 20px;<br>            font-size: 12px;<br>            font-weight: bold;<br>            z-index: 1000;<br>        }<br>        .firebase-connected {<br>            background: #10b981;<br>            color: white;<br>        }<br>        .firebase-disconnected {<br>            background: #ef4444;<br>            color: white;<br>        }<br>        .firebase-demo {<br>            background: #f59e0b;<br>            color: white;<br>        }<br>    </style><br></head><br><body class="bg-gray-50 min-h-full"><br>    <!-- Firebase Status Indicator --><br>    <div id="firebaseStatus" class="firebase-status firebase-demo"><br>        <i class="fas fa-exclamation-triangle"></i> وضع التجربة - يجب إعداد Firebase<br>    </div><br><br>    <!-- Header --><br>    <header class="gradient-bg text-white py-6 no-print"><br>        <div class="container mx-auto px-4 text-center"><br>            <div class="mb-4"><br>                <h2 class="text-2xl font-semibold mb-2 text-yellow-200">مدرسة ترعة ثقيف</h2><br>            </div><br>            <h1 class="text-4xl font-bold mb-2">السجل المهاري التطوعي</h1><br>            <p class="text-xl opacity-90">منصة تسجيل وإدارة الأعمال التطوعية للطلاب - مع قاعدة بيانات سحابية</p><br>        </div><br>    </header><br><br>    <!-- Navigation Tabs --><br>    <div class="container mx-auto px-4 py-6 no-print"><br>        <div class="flex justify-center space-x-4 space-x-reverse"><br>            <button onclick="showSection('student')" id="studentTab" class="btn-primary text-white px-8 py-3 rounded-lg font-semibold"><br>                <i class="fas fa-user-graduate ml-2"></i>قسم الطالب<br>            </button><br>            <button onclick="showSection('supervisor')" id="supervisorTab" class="bg-gray-300 text-gray-700 px-8 py-3 rounded-lg font-semibold hover:bg-gray-400 transition-all"><br>                <i class="fas fa-chalkboard-teacher ml-2"></i>قسم المشرف<br>            </button><br>        </div><br>    </div><br><br>    <!-- Student Section --><br>    <div id="studentSection" class="container mx-auto px-4 pb-8"><br>        <!-- Student Login --><br>        <div id="studentLogin" class="max-w-md mx-auto bg-white rounded-xl card-shadow p-8 mb-8"><br>            <h2 class="text-2xl font-bold text-center mb-6 text-gray-800">تسجيل دخول الطالب</h2><br>            <br>            <!-- National ID Input Step --><br>            <div id="studentIdStep"><br>                <form onsubmit="loginWithNationalId(event)"><br>                    <div class="mb-4"><br>                        <label class="block text-gray-700 font-semibold mb-2">رقم الهوية الوطنية</label><br>                        <input type="text" id="studentNationalId" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="1xxxxxxxxx" maxlength="10" required><br>                        <p class="text-sm text-gray-500 mt-1">أدخل رقم الهوية الوطنية المكون من 10 أرقام</p><br>                    </div><br>                    <button type="submit" class="w-full btn-primary text-white py-3 rounded-lg font-semibold"><br>                        <i class="fas fa-sign-in-alt ml-2"></i>دخول<br>                    </button><br>                </form><br>            </div><br><br>            <!-- New Student Registration Step --><br>            <div id="studentRegistrationStep" class="hidden"><br>                <div class="text-center mb-4"><br>                    <div class="bg-blue-100 border border-blue-300 text-blue-700 px-4 py-3 rounded-lg"><br>                        <p class="font-semibold">مرحباً بك!</p><br>                        <p class="text-sm">لم نجد ملف مسجل بهذه الهوية. يرجى إكمال التسجيل</p><br>                    </div><br>                </div><br>                <form onsubmit="registerNewStudent(event)"><br>                    <div class="mb-4"><br>                        <label class="block text-gray-700 font-semibold mb-2">الاسم الكامل</label><br>                        <input type="text" id="studentFullNameRegister" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="الاسم الكامل" required><br>                    </div><br>                    <div class="space-y-3"><br>                        <button type="submit" class="w-full btn-primary text-white py-3 rounded-lg font-semibold"><br>                            <i class="fas fa-user-plus ml-2"></i>إنشاء ملف جديد<br>                        </button><br>                        <button type="button" onclick="backToNationalIdStep()" class="w-full bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-lg font-semibold"><br>                            <i class="fas fa-arrow-right ml-2"></i>العودة<br>                        </button><br>                    </div><br>                </form><br>            </div><br>        </div><br><br>        <!-- Student Profile Form --><br>        <div id="studentProfile" class="hidden"><br>            <div class="bg-white rounded-xl card-shadow p-8 mb-8"><br>                <div class="text-center mb-6"><br>                    <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white py-4 px-6 rounded-lg mb-4"><br>                        <h2 class="text-2xl font-bold">مرحباً بك في السجل المهاري التطوعي</h2><br>                        <p id="studentWelcomeName" class="text-lg mt-2 opacity-90">الطالب: غير محدد</p><br>                        <p id="studentNationalIdDisplay" class="text-sm mt-1 opacity-75">الهوية الوطنية: غير محدد</p><br>                    </div><br>                </div><br>                <div class="flex justify-between items-center mb-6 no-print"><br>                    <h3 class="text-3xl font-bold text-gray-800">ملف الطالب الشخصي</h3><br>                    <button onclick="printStudentRecord()" class="btn-primary text-white px-6 py-2 rounded-lg"><br>                        <i class="fas fa-print ml-2"></i>طباعة السجل<br>                    </button><br>                </div><br><br>                <!-- Student Information --><br>                <div class="print-section mb-8"><br>                    <h3 class="text-2xl font-semibold mb-6 text-blue-600 border-b-2 border-blue-200 pb-2">معلومات الطالب</h3><br>                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6"><br>                        <div><br>                            <label class="block text-gray-700 font-semibold mb-2">الاسم الكامل</label><br>                            <input type="text" id="fullName" onchange="updateStudentName()" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><br>                        </div><br>                        <div><br>                            <label class="block text-gray-700 font-semibold mb-2">الرقم التعريفي</label><br>                            <input type="text" id="studentId" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><br>                        </div><br>                        <div><br>                            <label class="block text-gray-700 font-semibold mb-2">المدرسة</label><br>                            <input type="text" id="school" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" value="مدرسة ترعة ثقيف"><br>                        </div><br>                        <div><br>                            <label class="block text-gray-700 font-semibold mb-2">المرحلة الدراسية</label><br>                            <input type="text" id="grade" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><br>                        </div><br>                        <div><br>                            <label class="block text-gray-700 font-semibold mb-2">رقم الهوية الوطنية</label><br>                            <input type="text" id="nationalId" class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100" readonly><br>                        </div><br>                        <div><br>                            <label class="block text-gray-700 font-semibold mb-2">رقم الهاتف</label><br>                            <input type="tel" id="phoneNumber" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><br>                        </div><br>                        <div><br>                            <label class="block text-gray-700 font-semibold mb-2">البريد الإلكتروني</label><br>                            <input type="email" id="email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><br>                        </div><br>                        <div><br>                            <label class="block text-gray-700 font-semibold mb-2">الفصل الدراسي الحالي</label><br>                            <input type="text" id="currentSemester" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><br>                        </div><br>                    </div><br>                </div><br><br>                <!-- Goals Section --><br>                <div class="print-section mb-8"><br>                    <h3 class="text-2xl font-semibold mb-6 text-green-600 border-b-2 border-green-200 pb-2">الأهداف</h3><br>                    <div class="space-y-6"><br>                        <div><br>                            <label class="block text-gray-700 font-semibold mb-2">الأهداف الشخصية والتعليمية والمهنية</label><br>                            <textarea id="personalGoals" rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"></textarea><br>                        </div><br>                        <div><br>                            <label class="block text-gray-700 font-semibold mb-2">الهدف التعليمي الأكاديمي</label><br>                            <textarea id="academicGoal" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"></textarea><br>                        </div><br>                        <div><br>                            <label class="block text-gray-700 font-semibold mb-2">الهدف التعليمي المهاري</label><br>                            <textarea id="skillGoal" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"></textarea><br>                        </div><br>                    </div><br>                </div><br><br>                <!-- Volunteer Work Section --><br>                <div class="print-section mb-8"><br>                    <div class="flex justify-between items-center mb-6"><br>                        <h3 class="text-2xl font-semibold text-purple-600 border-b-2 border-purple-200 pb-2">الأعمال التطوعية</h3><br>                        <button onclick="addVolunteerOpportunity()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg no-print"><br>                            <i class="fas fa-plus ml-2"></i>إضافة فرصة<br>                        </button><br>                    </div><br>                    <div id="volunteerOpportunities"><br>                        <!-- Volunteer opportunities will be added here --><br>                    </div><br>                </div><br><br>                <div class="text-center no-print"><br>                    <button onclick="saveStudentData()" class="btn-primary text-white px-8 py-3 rounded-lg font-semibold"><br>                        <i class="fas fa-save ml-2"></i>حفظ البيانات<br>                    </button><br>                </div><br>            </div><br>        </div><br>    </div><br><br>    <!-- Supervisor Section --><br>    <div id="supervisorSection" class="hidden container mx-auto px-4 pb-8"><br>        <!-- Supervisor Login --><br>        <div id="supervisorLogin" class="max-w-md mx-auto bg-white rounded-xl card-shadow p-8 mb-8"><br>            <h2 class="text-2xl font-bold text-center mb-6 text-gray-800">تسجيل دخول المشرف</h2><br>            <br>            <!-- Phone Input Step --><br>            <div id="supervisorPhoneStep"><br>                <form onsubmit="sendSupervisorCode(event)"><br>                    <div class="mb-4"><br>                        <label class="block text-gray-700 font-semibold mb-2">رقم الهاتف</label><br>                        <input type="tel" id="supervisorPhone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="05xxxxxxxx" required><br>                        <p class="text-sm text-gray-500 mt-1">أدخل رقم الهاتف المسجل في النظام</p><br>                    </div><br>                    <button type="submit" class="w-full btn-primary text-white py-3 rounded-lg font-semibold"><br>                        <i class="fas fa-paper-plane ml-2"></i>إرسال كود التحقق<br>                    </button><br>                </form><br>            </div><br><br>            <!-- Verification Code Step --><br>            <div id="supervisorCodeStep" class="hidden"><br>                <form onsubmit="verifySupervisorCode(event)"><br>                    <div class="mb-4"><br>                        <label class="block text-gray-700 font-semibold mb-2">كود التحقق</label><br>                        <input type="text" id="supervisorVerificationCode" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-center text-2xl" placeholder="****" maxlength="4" required><br>                        <p class="text-sm text-gray-500 mt-1">أدخل كود التحقق المرسل إلى رقمك</p><br>                    </div><br>                    <div class="mb-4"><br>                        <label class="block text-gray-700 font-semibold mb-2">اسم المشرف</label><br>                        <input type="text" id="supervisorName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required><br>                    </div><br>                    <div class="space-y-3"><br>                        <button type="submit" class="w-full btn-primary text-white py-3 rounded-lg font-semibold"><br>                            <i class="fas fa-sign-in-alt ml-2"></i>تسجيل الدخول<br>                        </button><br>                        <button type="button" onclick="backToPhoneStep()" class="w-full bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-lg font-semibold"><br>                            <i class="fas fa-arrow-right ml-2"></i>العودة لإدخال الرقم<br>                        </button><br>                    </div><br>                </form><br>            </div><br>        </div><br><br>        <!-- Supervisor Dashboard --><br>        <div id="supervisorDashboard" class="hidden"><br>            <div class="bg-white rounded-xl card-shadow p-8 mb-8"><br>                <h2 class="text-3xl font-bold text-gray-800 mb-6">لوحة تحكم المشرف</h2><br>                <br>                <!-- Students List --><br>                <div class="mb-8"><br>                    <div class="flex justify-between items-center mb-4"><br>                        <h3 class="text-2xl font-semibold text-blue-600">قائمة الطلاب المسجلين</h3><br>                        <button onclick="loadAllStudents()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg"><br>                            <i class="fas fa-sync ml-2"></i>تحديث القائمة<br>                        </button><br>                    </div><br>                    <div class="mb-4"><br>                        <label class="block text-gray-700 font-semibold mb-2">اختر طالب للمراجعة</label><br>                        <select id="studentsList" onchange="viewStudentDetails()" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><br>                            <option value="">-- اختر طالب --</option><br>                        </select><br>                    </div><br>                </div><br><br>                <!-- Student Details View --><br>                <div id="studentDetailsView" class="hidden mb-8"><br>                    <div class="bg-gray-50 rounded-lg p-6"><br>                        <h4 class="text-xl font-semibold mb-4 text-green-600">تفاصيل الطالب</h4><br>                        <div id="studentDetailsContent"></div><br>                        <div class="mt-6 space-x-4 space-x-reverse"><br>                            <button onclick="editStudentData()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-2 rounded-lg"><br>                                <i class="fas fa-edit ml-2"></i>تعديل البيانات<br>                            </button><br>                            <button onclick="approveStudent()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg"><br>                                <i class="fas fa-check ml-2"></i>اعتماد السجل<br>                            </button><br>                        </div><br>                    </div><br>                </div><br><br>                <!-- Student Edit Form --><br>                <div id="studentEditForm" class="hidden mb-8"><br>                    <div class="bg-blue-50 rounded-lg p-6"><br>                        <h4 class="text-xl font-semibold mb-4 text-blue-600">تعديل بيانات الطالب</h4><br>                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><br>                            <div><br>                                <label class="block text-gray-700 font-semibold mb-2">الاسم الكامل</label><br>                                <input type="text" id="editFullName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><br>                            </div><br>                            <div><br>                                <label class="block text-gray-700 font-semibold mb-2">الرقم التعريفي</label><br>                                <input type="text" id="editStudentId" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><br>                            </div><br>                            <div><br>                                <label class="block text-gray-700 font-semibold mb-2">المدرسة</label><br>                                <input type="text" id="editSchool" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><br>                            </div><br>                            <div><br>                                <label class="block text-gray-700 font-semibold mb-2">المرحلة الدراسية</label><br>                                <input type="text" id="editGrade" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><br>                            </div><br>                            <div><br>                                <label class="block text-gray-700 font-semibold mb-2">رقم الهوية الوطنية</label><br>                                <input type="text" id="editNationalId" class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100" readonly><br>                            </div><br>                            <div><br>                                <label class="block text-gray-700 font-semibold mb-2">رقم الهاتف</label><br>                                <input type="tel" id="editPhoneNumber" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><br>                            </div><br>                            <div><br>                                <label class="block text-gray-700 font-semibold mb-2">البريد الإلكتروني</label><br>                                <input type="email" id="editEmail" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><br>                            </div><br>                            <div><br>                                <label class="block text-gray-700 font-semibold mb-2">الفصل الدراسي الحالي</label><br>                                <input type="text" id="editCurrentSemester" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><br>                            </div><br>                        </div><br>                        <div class="mt-6 space-x-4 space-x-reverse"><br>                            <button onclick="saveStudentEdits()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg"><br>                                <i class="fas fa-save ml-2"></i>حفظ التعديلات<br>                            </button><br>                            <button onclick="cancelStudentEdit()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg"><br>                                <i class="fas fa-times ml-2"></i>إلغاء<br>                            </button><br>                        </div><br>                    </div><br>                </div><br><br>                <!-- Supervisor Recommendation --><br>                <div class="print-section mb-8"><br>                    <h3 class="text-2xl font-semibold mb-6 text-orange-600 border-b-2 border-orange-200 pb-2">توصية المشرف الأكاديمي التربوي</h3><br>                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6"><br>                        <div><br>                            <label class="block text-gray-700 font-semibold mb-2">اسم المشرف</label><br>                            <input type="text" id="supervisorNameField" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><br>                        </div><br>                        <div><br>                            <label class="block text-gray-700 font-semibold mb-2">تاريخ التقييم</label><br>                            <input type="date" id="evaluationDate" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><br>                        </div><br>                        <div class="md:col-span-2"><br>                            <label class="block text-gray-700 font-semibold mb-2">التوقيع</label><br>                            <input type="text" id="supervisorSignature" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="التوقيع الإلكتروني"><br>                        </div><br>                    </div><br>                </div><br><br>                <!-- Certification Section --><br>                <div class="print-section mb-8"><br>                    <h3 class="text-2xl font-semibold mb-6 text-red-600 border-b-2 border-red-200 pb-2">ختم واعتماد السجل المهاري</h3><br>                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6"><br>                        <div><br>                            <label class="block text-gray-700 font-semibold mb-2">الجهة المعتمدة</label><br>                            <input type="text" id="certifyingAuthority" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" value="مدرسة ترعة ثقيف"><br>                        </div><br>                        <div><br>                            <label class="block text-gray-700 font-semibold mb-2">تاريخ الإصدار</label><br>                            <input type="date" id="issueDate" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><br>                        </div><br>                        <div class="md:col-span-2"><br>                            <label class="block text-gray-700 font-semibold mb-2">التوقيع والختم</label><br>                            <input type="text" id="officialSignature" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="التوقيع والختم الرسمي"><br>                        </div><br>                    </div><br>                </div><br>            </div><br>        </div><br>    </div><br><br>    <!-- Firebase Setup Instructions Modal --><br>    <div id="firebaseModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"><br>        <div class="bg-white rounded-xl p-8 max-w-2xl mx-4 max-h-96 overflow-y-auto"><br>            <h3 class="text-2xl font-bold mb-4 text-blue-600">إعداد Firebase للنظام</h3><br>            <div class="space-y-4 text-sm"><br>                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4"><br>                    <h4 class="font-bold text-yellow-800 mb-2">خطوات الإعداد:</h4><br>                    <ol class="list-decimal list-inside space-y-2 text-yellow-700"><br>                        <li>اذهب إلى <a href="https://console.firebase.google.com" target="_blank" class="text-blue-600 underline">Firebase Console</a></li><br>                        <li>أنشئ مشروع جديد</li><br>                        <li>فعّل Firestore Database</li><br>                        <li>أضف تطبيق ويب جديد</li><br>                        <li>انسخ إعدادات Firebase واستبدلها في الكود</li><br>                        <li>اضبط قواعد Firestore للسماح بالقراءة والكتابة</li><br>                    </ol><br>                </div><br>                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4"><br>                    <h4 class="font-bold text-blue-800 mb-2">قواعد Firestore المطلوبة:</h4><br>                    <pre class="text-xs bg-gray-100 p-2 rounded">rules_version = '2';<br>service cloud.firestore {<br>  match /databases/{database}/documents {<br>    match /{document=**} {<br>      allow read, write: if true;<br>    }<br>  }<br>}</pre><br>                </div><br>            </div><br>            <button onclick="closeFirebaseModal()" class="mt-6 w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-lg"><br>                فهمت، سأقوم بالإعداد لاحقاً<br>            </button><br>        </div><br>    </div><br><br>    <!-- Footer --><br>    <footer class="gradient-bg text-white py-8 no-print"><br>        <div class="container mx-auto px-4 text-center"><br>            <div class="mb-6"><br>                <h3 class="text-xl font-semibold mb-4">تصميم أ.عبدالرحمن الثقفي</h3><br>                <div class="flex justify-center space-x-6 space-x-reverse"><br>                    <a href="https://x.com/a_a_althagafi?t=SKoq7PoEIK_sP9WabZ7QYA&s=09" target="_blank" rel="noopener noreferrer" class="text-white hover:text-blue-300 transition-colors"><br>                        <i class="fab fa-twitter text-2xl"></i><br>                        <span class="block text-sm mt-1">تويتر</span><br>                    </a><br>                    <a href="https://t.me/althagafi993" target="_blank" rel="noopener noreferrer" class="text-white hover:text-blue-300 transition-colors"><br>                        <i class="fab fa-telegram text-2xl"></i><br>                        <span class="block text-sm mt-1">تليجرام</span><br>                    </a><br>                </div><br>            </div><br>            <p class="text-sm opacity-75">© 2024 السجل المهاري التطوعي - جميع الحقوق محفوظة</p><br>        </div><br>    </footer><br><br>    <script><br>        let currentSection = 'student';<br>        let volunteerCount = 0;<br>        let studentsData = [];<br>        let currentEditingStudentIndex = -1;<br>        let currentStudentDocId = null;<br>        let isFirebaseReady = false;<br><br>        // Firebase functions<br>        async function saveStudentToFirebase(studentData) {<br>            if (!isFirebaseReady) {<br>                showErrorMessage('Firebase غير متصل. يتم الحفظ محلياً فقط.');<br>                return null;<br>            }<br>            <br>            try {<br>                const docRef = await window.firestore.addDoc(window.firestore.collection(window.db, 'students'), {<br>                    ...studentData,<br>                    createdAt: new Date(),<br>                    updatedAt: new Date()<br>                });<br>                showSuccessMessage('تم حفظ البيانات في قاعدة البيانات السحابية!');<br>                return docRef.id;<br>            } catch (error) {<br>                console.error('خطأ في حفظ البيانات:', error);<br>                showErrorMessage('خطأ في الحفظ السحابي. تم الحفظ محلياً.');<br>                return null;<br>            }<br>        }<br><br>        async function updateStudentInFirebase(docId, studentData) {<br>            if (!isFirebaseReady || !docId) {<br>                showErrorMessage('Firebase غير متصل. يتم الحفظ محلياً فقط.');<br>                return false;<br>            }<br>            <br>            try {<br>                await window.firestore.updateDoc(window.firestore.doc(window.db, 'students', docId), {<br>                    ...studentData,<br>                    updatedAt: new Date()<br>                });<br>                showSuccessMessage('تم تحديث البيانات في قاعدة البيانات السحابية!');<br>                return true;<br>            } catch (error) {<br>                console.error('خطأ في تحديث البيانات:', error);<br>                showErrorMessage('خطأ في التحديث السحابي. تم الحفظ محلياً.');<br>                return false;<br>            }<br>        }<br><br>        async function loadStudentFromFirebase(nationalId) {<br>            if (!isFirebaseReady) {<br>                return null;<br>            }<br>            <br>            try {<br>                const q = window.firestore.query(<br>                    window.firestore.collection(window.db, 'students'),<br>                    window.firestore.where('nationalId', '==', nationalId)<br>                );<br>                const querySnapshot = await window.firestore.getDocs(q);<br>                <br>                if (!querySnapshot.empty) {<br>                    const doc = querySnapshot.docs[0];<br>                    return { id: doc.id, ...doc.data() };<br>                }<br>                return null;<br>            } catch (error) {<br>                console.error('خطأ في تحميل البيانات:', error);<br>                return null;<br>            }<br>        }<br><br>        async function loadAllStudentsFromFirebase() {<br>            if (!isFirebaseReady) {<br>                return [];<br>            }<br>            <br>            try {<br>                const q = window.firestore.query(<br>                    window.firestore.collection(window.db, 'students'),<br>                    window.firestore.orderBy('createdAt', 'desc')<br>                );<br>                const querySnapshot = await window.firestore.getDocs(q);<br>                <br>                const students = [];<br>                querySnapshot.forEach((doc) => {<br>                    students.push({ id: doc.id, ...doc.data() });<br>                });<br>                return students;<br>            } catch (error) {<br>                console.error('خطأ في تحميل قائمة الطلاب:', error);<br>                return [];<br>            }<br>        }<br><br>        // Check Firebase connection<br>        function checkFirebaseConnection() {<br>            try {<br>                if (window.db && window.firestore) {<br>                    isFirebaseReady = true;<br>                    updateFirebaseStatus('connected');<br>                } else {<br>                    isFirebaseReady = false;<br>                    updateFirebaseStatus('demo');<br>                }<br>            } catch (error) {<br>                isFirebaseReady = false;<br>                updateFirebaseStatus('demo');<br>            }<br>        }<br><br>        function updateFirebaseStatus(status) {<br>            const statusElement = document.getElementById('firebaseStatus');<br>            <br>            switch (status) {<br>                case 'connected':<br>                    statusElement.className = 'firebase-status firebase-connected';<br>                    statusElement.innerHTML = '<i class="fas fa-check-circle"></i> متصل بقاعدة البيانات السحابية';<br>                    break;<br>                case 'disconnected':<br>                    statusElement.className = 'firebase-status firebase-disconnected';<br>                    statusElement.innerHTML = '<i class="fas fa-times-circle"></i> غير متصل بقاعدة البيانات';<br>                    break;<br>                default:<br>                    statusElement.className = 'firebase-status firebase-demo';<br>                    statusElement.innerHTML = '<i class="fas fa-exclamation-triangle"></i> وضع التجربة - يجب إعداد Firebase';<br>                    statusElement.style.cursor = 'pointer';<br>                    statusElement.onclick = () => showFirebaseModal();<br>            }<br>        }<br><br>        function showFirebaseModal() {<br>            document.getElementById('firebaseModal').classList.remove('hidden');<br>        }<br><br>        function closeFirebaseModal() {<br>            document.getElementById('firebaseModal').classList.add('hidden');<br>        }<br><br>        // Load data from localStorage (fallback)<br>        function loadDataFromStorage() {<br>            const savedData = localStorage.getItem('studentsData');<br>            if (savedData) {<br>                studentsData = JSON.parse(savedData);<br>                updateStudentsList();<br>            }<br>            <br>            const savedVolunteerCount = localStorage.getItem('volunteerCount');<br>            if (savedVolunteerCount) {<br>                volunteerCount = parseInt(savedVolunteerCount);<br>            }<br>        }<br><br>        // Save data to localStorage (fallback)<br>        function saveDataToStorage() {<br>            localStorage.setItem('studentsData', JSON.stringify(studentsData));<br>            localStorage.setItem('volunteerCount', volunteerCount.toString());<br>        }<br><br>        function showSection(section) {<br>            const studentSection = document.getElementById('studentSection');<br>            const supervisorSection = document.getElementById('supervisorSection');<br>            const studentTab = document.getElementById('studentTab');<br>            const supervisorTab = document.getElementById('supervisorTab');<br><br>            if (section === 'student') {<br>                studentSection.classList.remove('hidden');<br>                supervisorSection.classList.add('hidden');<br>                studentTab.className = 'btn-primary text-white px-8 py-3 rounded-lg font-semibold';<br>                supervisorTab.className = 'bg-gray-300 text-gray-700 px-8 py-3 rounded-lg font-semibold hover:bg-gray-400 transition-all';<br>            } else {<br>                studentSection.classList.add('hidden');<br>                supervisorSection.classList.remove('hidden');<br>                supervisorTab.className = 'btn-primary text-white px-8 py-3 rounded-lg font-semibold';<br>                studentTab.className = 'bg-gray-300 text-gray-700 px-8 py-3 rounded-lg font-semibold hover:bg-gray-400 transition-all';<br>            }<br>            currentSection = section;<br>        }<br><br>        // Authorized supervisor phones and their verification codes<br>        const authorizedSupervisors = {<br>            '0556706655': '4243',<br>            '0502001993': '2122'<br>        };<br>        let currentSupervisorPhone = '';<br><br>        // Student Authentication Functions<br>        async function loginWithNationalId(event) {<br>            event.preventDefault();<br>            const nationalId = document.getElementById('studentNationalId').value;<br>            <br>            if (nationalId && nationalId.match(/^[12]\d{9}$/)) {<br>                showLoadingMessage('جاري البحث عن الملف...');<br>                <br>                // Try to load from Firebase first<br>                let existingStudent = await loadStudentFromFirebase(nationalId);<br>                <br>                // If not found in Firebase, check localStorage<br>                if (!existingStudent) {<br>                    existingStudent = studentsData.find(student => student.nationalId === nationalId);<br>                }<br>                <br>                if (existingStudent) {<br>                    // Load existing student data<br>                    loadStudentData(existingStudent);<br>                    currentStudentDocId = existingStudent.id;<br>                    showSuccessMessage(`مرحباً بعودتك ${existingStudent.fullName}!`);<br>                    document.getElementById('studentLogin').classList.add('hidden');<br>                    document.getElementById('studentProfile').classList.remove('hidden');<br>                } else {<br>                    // Show registration form for new student<br>                    document.getElementById('studentIdStep').classList.add('hidden');<br>                    document.getElementById('studentRegistrationStep').classList.remove('hidden');<br>                }<br>            } else {<br>                showErrorMessage('يرجى إدخال رقم هوية وطنية صحيح (10 أرقام تبدأ بـ 1 أو 2)');<br>            }<br>        }<br><br>        async function registerNewStudent(event) {<br>            event.preventDefault();<br>            const nationalId = document.getElementById('studentNationalId').value;<br>            const fullName = document.getElementById('studentFullNameRegister').value;<br>            <br>            if (fullName.trim()) {<br>                showLoadingMessage('جاري إنشاء الملف...');<br>                <br>                // Create new student profile<br>                const newStudent = {<br>                    nationalId: nationalId,<br>                    fullName: fullName,<br>                    studentId: '',<br>                    school: 'مدرسة ترعة ثقيف',<br>                    grade: '',<br>                    phoneNumber: '',<br>                    email: '',<br>                    currentSemester: '',<br>                    personalGoals: '',<br>                    academicGoal: '',<br>                    skillGoal: '',<br>                    volunteerOpportunities: [],<br>                    approved: false<br>                };<br>                <br>                // Save to Firebase<br>                const docId = await saveStudentToFirebase(newStudent);<br>                if (docId) {<br>                    currentStudentDocId = docId;<br>                    newStudent.id = docId;<br>                }<br>                <br>                // Save to localStorage as fallback<br>                newStudent.id = newStudent.id || Date.now();<br>                studentsData.push(newStudent);<br>                saveDataToStorage();<br>                <br>                loadStudentData(newStudent);<br>                showSuccessMessage(`مرحباً بك ${fullName}! تم إنشاء ملفك الشخصي`);<br>                <br>                document.getElementById('studentLogin').classList.add('hidden');<br>                document.getElementById('studentProfile').classList.remove('hidden');<br>            } else {<br>                showErrorMessage('يرجى إدخال الاسم الكامل');<br>            }<br>        }<br><br>        function backToNationalIdStep() {<br>            document.getElementById('studentRegistrationStep').classList.add('hidden');<br>            document.getElementById('studentIdStep').classList.remove('hidden');<br>            document.getElementById('studentNationalId').value = '';<br>        }<br><br>        function loadStudentData(student) {<br>            document.getElementById('fullName').value = student.fullName || '';<br>            document.getElementById('studentId').value = student.studentId || '';<br>            document.getElementById('school').value = student.school || 'مدرسة ترعة ثقيف';<br>            document.getElementById('grade').value = student.grade || '';<br>            document.getElementById('nationalId').value = student.nationalId || '';<br>            document.getElementById('phoneNumber').value = student.phoneNumber || '';<br>            document.getElementById('email').value = student.email || '';<br>            document.getElementById('currentSemester').value = student.currentSemester || '';<br>            document.getElementById('personalGoals').value = student.personalGoals || '';<br>            document.getElementById('academicGoal').value = student.academicGoal || '';<br>            document.getElementById('skillGoal').value = student.skillGoal || '';<br>            <br>            // Load volunteer opportunities<br>            const volunteerContainer = document.getElementById('volunteerOpportunities');<br>            volunteerContainer.innerHTML = '';<br>            volunteerCount = 0;<br>            <br>            if (student.volunteerOpportunities && student.volunteerOpportunities.length > 0) {<br>                student.volunteerOpportunities.forEach(opportunity => {<br>                    addVolunteerOpportunity();<br>                    const lastOpportunity = volunteerContainer.lastElementChild;<br>                    const inputs = lastOpportunity.querySelectorAll('input, textarea, select');<br>                    <br>                    inputs[0].value = opportunity.name || '';<br>                    inputs[1].value = opportunity.organization || '';<br>                    inputs[2].value = opportunity.description || '';<br>                    inputs[3].value = opportunity.type || '';<br>                    inputs[4].value = opportunity.difficulty || '';<br>                    inputs[5].value = opportunity.role || '';<br>                    inputs[6].value = opportunity.dates || '';<br>                    inputs[7].value = opportunity.hours || '';<br>                    inputs[8].value = opportunity.signature || '';<br>                    <br>                    // Load skills for this opportunity<br>                    if (opportunity.skills && opportunity.skills.length > 0) {<br>                        const skillsContainer = lastOpportunity.querySelector(`#skills-${volunteerCount}`);<br>                        skillsContainer.innerHTML = '';<br>                        <br>                        opportunity.skills.forEach(skill => {<br>                            addSkill(volunteerCount);<br>                            const lastSkill = skillsContainer.lastElementChild;<br>                            const skillInputs = lastSkill.querySelectorAll('input, select');<br>                            skillInputs[0].value = skill.name || '';<br>                            skillInputs[1].value = skill.level || '';<br>                        });<br>                    }<br>                });<br>            }<br>            <br>            // Update welcome message<br>            updateStudentName();<br>            updateStudentNationalId();<br>        }<br><br>        // Supervisor Authentication Functions<br>        function sendSupervisorCode(event) {<br>            event.preventDefault();<br>            const phone = document.getElementById('supervisorPhone').value;<br>            <br>            if (authorizedSupervisors[phone]) {<br>                currentSupervisorPhone = phone;<br>                document.getElementById('supervisorPhoneStep').classList.add('hidden');<br>                document.getElementById('supervisorCodeStep').classList.remove('hidden');<br>                showSuccessMessage(`تم إرسال كود التحقق إلى ${phone}`);<br>                <br>                // Show the verification code in console for testing<br>                console.log(`كود التحقق لرقم ${phone}: ${authorizedSupervisors[phone]}`);<br>            } else {<br>                showErrorMessage('رقم الهاتف غير مسجل في النظام');<br>            }<br>        }<br><br>        async function verifySupervisorCode(event) {<br>            event.preventDefault();<br>            const code = document.getElementById('supervisorVerificationCode').value;<br>            const name = document.getElementById('supervisorName').value;<br>            <br>            if (code === authorizedSupervisors[currentSupervisorPhone] && name.trim()) {<br>                document.getElementById('supervisorLogin').classList.add('hidden');<br>                document.getElementById('supervisorDashboard').classList.remove('hidden');<br>                document.getElementById('supervisorNameField').value = name;<br>                <br>                // Load all students<br>                await loadAllStudents();<br>                <br>                showSuccessMessage('تم تسجيل الدخول بنجاح! مرحباً بك في لوحة التحكم');<br>            } else if (code !== authorizedSupervisors[currentSupervisorPhone]) {<br>                showErrorMessage('كود التحقق غير صحيح');<br>            } else {<br>                showErrorMessage('يرجى إدخال اسم المشرف');<br>            }<br>        }<br><br>        function backToPhoneStep() {<br>            document.getElementById('supervisorCodeStep').classList.add('hidden');<br>            document.getElementById('supervisorPhoneStep').classList.remove('hidden');<br>            document.getElementById('supervisorPhone').value = '';<br>            document.getElementById('supervisorVerificationCode').value = '';<br>            document.getElementById('supervisorName').value = '';<br>            currentSupervisorPhone = '';<br>        }<br><br>        async function loadAllStudents() {<br>            showLoadingMessage('جاري تحميل قائمة الطلاب...');<br>            <br>            // Load from Firebase first<br>            const firebaseStudents = await loadAllStudentsFromFirebase();<br>            <br>            // Merge with localStorage data<br>            const localStudents = studentsData || [];<br>            <br>            // Combine and remove duplicates based on nationalId<br>            const allStudents = [...firebaseStudents];<br>            localStudents.forEach(localStudent => {<br>                if (!allStudents.find(s => s.nationalId === localStudent.nationalId)) {<br>                    allStudents.push(localStudent);<br>                }<br>            });<br>            <br>            studentsData = allStudents;<br>            updateStudentsList();<br>            <br>            if (allStudents.length > 0) {<br>                showSuccessMessage(`تم تحميل ${allStudents.length} طالب`);<br>            } else {<br>                showInfoMessage('لا توجد بيانات طلاب مسجلة حتى الآن');<br>            }<br>        }<br><br>        function addVolunteerOpportunity() {<br>            volunteerCount++;<br>            const container = document.getElementById('volunteerOpportunities');<br>            const opportunityDiv = document.createElement('div');<br>            opportunityDiv.className = 'border-2 border-gray-200 rounded-lg p-6 mb-6 bg-gray-50';<br>            opportunityDiv.innerHTML = `<br>                <div class="flex justify-between items-center mb-4"><br>                    <h4 class="text-xl font-semibold text-purple-600">الفرصة التطوعية ${volunteerCount}</h4><br>                    <button onclick="removeOpportunity(this)" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded no-print"><br>                        <i class="fas fa-trash"></i><br>                    </button><br>                </div><br>                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><br>                    <div><br>                        <label class="block text-gray-700 font-semibold mb-2">اسم الفرصة التطوعية</label><br>                        <input type="text" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><br>                    </div><br>                    <div><br>                        <label class="block text-gray-700 font-semibold mb-2">الجهة المنظمة</label><br>                        <input type="text" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><br>                    </div><br>                    <div class="md:col-span-2"><br>                        <label class="block text-gray-700 font-semibold mb-2">وصف الفرصة</label><br>                        <textarea rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"></textarea><br>                    </div><br>                    <div><br>                        <label class="block text-gray-700 font-semibold mb-2">نوع الفرصة</label><br>                        <select class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><br>                            <option value="">اختر النوع</option><br>                            <option value="field">ميدانية</option><br>                            <option value="remote">عن بُعد</option><br>                        </select><br>                    </div><br>                    <div><br>                        <label class="block text-gray-700 font-semibold mb-2">مستوى صعوبة الفرصة</label><br>                        <select class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><br>                            <option value="">اختر المستوى</option><br>                            <option value="1">1 - بالغ السهولة</option><br>                            <option value="2">2 - سهل</option><br>                            <option value="3">3 - متوسط</option><br>                            <option value="4">4 - صعب</option><br>                            <option value="5">5 - بالغ الصعوبة</option><br>                        </select><br>                    </div><br>                    <div><br>                        <label class="block text-gray-700 font-semibold mb-2">الدور والمهام</label><br>                        <textarea rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"></textarea><br>                    </div><br>                    <div><br>                        <label class="block text-gray-700 font-semibold mb-2">تاريخ البداية والانتهاء</label><br>                        <input type="text" placeholder="من تاريخ - إلى تاريخ" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><br>                    </div><br>                    <div><br>                        <label class="block text-gray-700 font-semibold mb-2">عدد الساعات</label><br>                        <input type="number" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><br>                    </div><br>                    <div><br>                        <label class="block text-gray-700 font-semibold mb-2">توقيع الجهة</label><br>                        <input type="text" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"><br>                    </div><br>                </div><br>                <div class="mb-4"><br>                    <label class="block text-gray-700 font-semibold mb-2">المهارات المكتسبة</label><br>                    <div id="skills-${volunteerCount}" class="space-y-2"><br>                        <div class="skill-item"><br>                            <div class="flex items-center space-x-4 space-x-reverse"><br>                                <input type="text" placeholder="اسم المهارة" class="flex-1 px-3 py-2 border border-gray-300 rounded"><br>                                <select class="px-3 py-2 border border-gray-300 rounded"><br>                                    <option value="">المستوى</option><br>                                    <option value="basic">بسيط</option><br>                                    <option value="intermediate">متوسط</option><br>                                    <option value="advanced">متقدم</option><br>                                </select><br>                                <button type="button" onclick="removeSkill(this)" class="bg-red-500 text-white px-2 py-1 rounded text-sm">حذف</button><br>                            </div><br>                        </div><br>                    </div><br>                    <button type="button" onclick="addSkill(${volunteerCount})" class="mt-2 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded"><br>                        <i class="fas fa-plus ml-1"></i>إضافة مهارة<br>                    </button><br>                </div><br>            `;<br>            container.appendChild(opportunityDiv);<br>        }<br><br>        function removeOpportunity(button) {<br>            button.closest('.border-2').remove();<br>        }<br><br>        function addSkill(opportunityId) {<br>            const skillsContainer = document.getElementById(`skills-${opportunityId}`);<br>            const skillDiv = document.createElement('div');<br>            skillDiv.className = 'skill-item';<br>            skillDiv.innerHTML = `<br>                <div class="flex items-center space-x-4 space-x-reverse"><br>                    <input type="text" placeholder="اسم المهارة" class="flex-1 px-3 py-2 border border-gray-300 rounded"><br>                    <select class="px-3 py-2 border border-gray-300 rounded"><br>                        <option value="">المستوى</option><br>                        <option value="basic">بسيط</option><br>                        <option value="intermediate">متوسط</option><br>                        <option value="advanced">متقدم</option><br>                    </select><br>                    <button type="button" onclick="removeSkill(this)" class="bg-red-500 text-white px-2 py-1 rounded text-sm">حذف</button><br>                </div><br>            `;<br>            skillsContainer.appendChild(skillDiv);<br>        }<br><br>        function removeSkill(button) {<br>            button.closest('.skill-item').remove();<br>        }<br><br>        async function saveStudentData() {<br>            showLoadingMessage('جاري حفظ البيانات...');<br>            <br>            const studentData = {<br>                fullName: document.getElementById('fullName').value,<br>                studentId: document.getElementById('studentId').value,<br>                school: document.getElementById('school').value,<br>                grade: document.getElementById('grade').value,<br>                nationalId: document.getElementById('nationalId').value,<br>                phoneNumber: document.getElementById('phoneNumber').value,<br>                email: document.getElementById('email').value,<br>                currentSemester: document.getElementById('currentSemester').value,<br>                personalGoals: document.getElementById('personalGoals').value,<br>                academicGoal: document.getElementById('academicGoal').value,<br>                skillGoal: document.getElementById('skillGoal').value,<br>                volunteerOpportunities: []<br>            };<br>            <br>            // Save volunteer opportunities<br>            const volunteerContainer = document.getElementById('volunteerOpportunities');<br>            const opportunityDivs = volunteerContainer.querySelectorAll('.border-2');<br>            <br>            opportunityDivs.forEach(div => {<br>                const inputs = div.querySelectorAll('input, textarea, select');<br>                const opportunity = {<br>                    name: inputs[0].value,<br>                    organization: inputs[1].value,<br>                    description: inputs[2].value,<br>                    type: inputs[3].value,<br>                    difficulty: inputs[4].value,<br>                    role: inputs[5].value,<br>                    dates: inputs[6].value,<br>                    hours: inputs[7].value,<br>                    signature: inputs[8].value,<br>                    skills: []<br>                };<br>                <br>                // Get skills for this opportunity<br>                const skillItems = div.querySelectorAll('.skill-item');<br>                skillItems.forEach(skillItem => {<br>                    const skillInputs = skillItem.querySelectorAll('input, select');<br>                    if (skillInputs[0].value.trim()) {<br>                        opportunity.skills.push({<br>                            name: skillInputs[0].value,<br>                            level: skillInputs[1].value<br>                        });<br>                    }<br>                });<br>                <br>                studentData.volunteerOpportunities.push(opportunity);<br>            });<br>            <br>            // Update in Firebase if we have a document ID<br>            if (currentStudentDocId) {<br>                await updateStudentInFirebase(currentStudentDocId, studentData);<br>            }<br>            <br>            // Update in localStorage<br>            const studentIndex = studentsData.findIndex(student => student.nationalId === studentData.nationalId);<br>            if (studentIndex !== -1) {<br>                studentsData[studentIndex] = { ...studentsData[studentIndex], ...studentData };<br>            }<br>            saveDataToStorage();<br>            <br>            showSuccessMessage('تم حفظ البيانات بنجاح!');<br>        }<br><br>        function updateStudentsList() {<br>            const select = document.getElementById('studentsList');<br>            select.innerHTML = '<option value="">-- اختر طالب --</option>';<br>            studentsData.forEach((student, index) => {<br>                const option = document.createElement('option');<br>                option.value = index;<br>                option.textContent = `${student.fullName} - ${student.nationalId}`;<br>                select.appendChild(option);<br>            });<br>        }<br><br>        function viewStudentDetails() {<br>            const select = document.getElementById('studentsList');<br>            const index = select.value;<br>            <br>            if (index !== '') {<br>                const student = studentsData[index];<br>                const detailsView = document.getElementById('studentDetailsView');<br>                const content = document.getElementById('studentDetailsContent');<br>                <br>                content.innerHTML = `<br>                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><br>                        <p><strong>الاسم:</strong> ${student.fullName}</p><br>                        <p><strong>الرقم التعريفي:</strong> ${student.studentId}</p><br>                        <p><strong>المدرسة:</strong> ${student.school}</p><br>                        <p><strong>المرحلة:</strong> ${student.grade}</p><br>                        <p><strong>رقم الهوية:</strong> ${student.nationalId}</p><br>                        <p><strong>الهاتف:</strong> ${student.phoneNumber}</p><br>                        <p><strong>البريد:</strong> ${student.email}</p><br>                        <p><strong>الفصل الحالي:</strong> ${student.currentSemester}</p><br>                        <p><strong>حالة الاعتماد:</strong> ${student.approved ? 'معتمد' : 'غير معتمد'}</p><br>                        <p><strong>عدد الأعمال التطوعية:</strong> ${student.volunteerOpportunities ? student.volunteerOpportunities.length : 0}</p><br>                    </div><br>                `;<br>                <br>                detailsView.classList.remove('hidden');<br>                currentEditingStudentIndex = index;<br>            } else {<br>                document.getElementById('studentDetailsView').classList.add('hidden');<br>                document.getElementById('studentEditForm').classList.add('hidden');<br>            }<br>        }<br><br>        function editStudentData() {<br>            if (currentEditingStudentIndex === -1) return;<br>            <br>            const student = studentsData[currentEditingStudentIndex];<br>            <br>            // Fill edit form with current data<br>            document.getElementById('editFullName').value = student.fullName;<br>            document.getElementById('editStudentId').value = student.studentId;<br>            document.getElementById('editSchool').value = student.school;<br>            document.getElementById('editGrade').value = student.grade;<br>            document.getElementById('editNationalId').value = student.nationalId;<br>            document.getElementById('editPhoneNumber').value = student.phoneNumber;<br>            document.getElementById('editEmail').value = student.email;<br>            document.getElementById('editCurrentSemester').value = student.currentSemester;<br>            <br>            document.getElementById('studentEditForm').classList.remove('hidden');<br>            showSuccessMessage('تم تفعيل وضع التعديل');<br>        }<br><br>        async function saveStudentEdits() {<br>            if (currentEditingStudentIndex === -1) return;<br>            <br>            showLoadingMessage('جاري حفظ التعديلات...');<br>            <br>            const updatedData = {<br>                fullName: document.getElementById('editFullName').value,<br>                studentId: document.getElementById('editStudentId').value,<br>                school: document.getElementById('editSchool').value,<br>                grade: document.getElementById('editGrade').value,<br>                phoneNumber: document.getElementById('editPhoneNumber').value,<br>                email: document.getElementById('editEmail').value,<br>                currentSemester: document.getElementById('editCurrentSemester').value<br>            };<br>            <br>            // Update student data<br>            Object.assign(studentsData[currentEditingStudentIndex], updatedData);<br>            <br>            // Update in Firebase if available<br>            const student = studentsData[currentEditingStudentIndex];<br>            if (student.id && isFirebaseReady) {<br>                await updateStudentInFirebase(student.id, updatedData);<br>            }<br>            <br>            // Save to localStorage<br>            saveDataToStorage();<br>            <br>            // Update display<br>            updateStudentsList();<br>            viewStudentDetails();<br>            document.getElementById('studentEditForm').classList.add('hidden');<br>            <br>            showSuccessMessage('تم حفظ التعديلات بنجاح!');<br>        }<br><br>        function cancelStudentEdit() {<br>            document.getElementById('studentEditForm').classList.add('hidden');<br>        }<br><br>        async function approveStudent() {<br>            if (currentEditingStudentIndex === -1) return;<br>            <br>            showLoadingMessage('جاري اعتماد السجل...');<br>            <br>            studentsData[currentEditingStudentIndex].approved = true;<br>            <br>            // Update in Firebase if available<br>            const student = studentsData[currentEditingStudentIndex];<br>            if (student.id && isFirebaseReady) {<br>                await updateStudentInFirebase(student.id, { approved: true });<br>            }<br>            <br>            // Save to localStorage<br>            saveDataToStorage();<br>            <br>            viewStudentDetails(); // Refresh the display<br>            showSuccessMessage('تم اعتماد سجل الطالب بنجاح!');<br>        }<br><br>        function printStudentRecord() {<br>            window.print();<br>        }<br><br>        function updateStudentName() {<br>            const fullName = document.getElementById('fullName').value;<br>            const welcomeElement = document.getElementById('studentWelcomeName');<br>            if (fullName.trim()) {<br>                welcomeElement.textContent = `الطالب: ${fullName}`;<br>            } else {<br>                welcomeElement.textContent = 'الطالب: غير محدد';<br>            }<br>        }<br><br>        function updateStudentNationalId() {<br>            const nationalId = document.getElementById('nationalId').value;<br>            const displayElement = document.getElementById('studentNationalIdDisplay');<br>            if (nationalId.trim()) {<br>                displayElement.textContent = `الهوية الوطنية: ${nationalId}`;<br>            } else {<br>                displayElement.textContent = 'الهوية الوطنية: غير محدد';<br>            }<br>        }<br><br>        function showSuccessMessage(message) {<br>            const messageDiv = document.createElement('div');<br>            messageDiv.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';<br>            messageDiv.innerHTML = `<br>                <div class="flex items-center"><br>                    <i class="fas fa-check-circle ml-2"></i><br>                    <span>${message}</span><br>                </div><br>            `;<br>            document.body.appendChild(messageDiv);<br>            <br>            setTimeout(() => {<br>                messageDiv.remove();<br>            }, 4000);<br>        }<br><br>        function showErrorMessage(message) {<br>            const messageDiv = document.createElement('div');<br>            messageDiv.className = 'fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';<br>            messageDiv.innerHTML = `<br>                <div class="flex items-center"><br>                    <i class="fas fa-exclamation-circle ml-2"></i><br>                    <span>${message}</span><br>                </div><br>            `;<br>            document.body.appendChild(messageDiv);<br>            <br>            setTimeout(() => {<br>                messageDiv.remove();<br>            }, 4000);<br>        }<br><br>        function showLoadingMessage(message) {<br>            const messageDiv = document.createElement('div');<br>            messageDiv.className = 'fixed top-4 right-4 bg-blue-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';<br>            messageDiv.innerHTML = `<br>                <div class="flex items-center"><br>                    <i class="fas fa-spinner fa-spin ml-2"></i><br>                    <span>${message}</span><br>                </div><br>            `;<br>            messageDiv.id = 'loadingMessage';<br>            document.body.appendChild(messageDiv);<br>            <br>            setTimeout(() => {<br>                const existing = document.getElementById('loadingMessage');<br>                if (existing) existing.remove();<br>            }, 3000);<br>        }<br><br>        function showInfoMessage(message) {<br>            const messageDiv = document.createElement('div');<br>            messageDiv.className = 'fixed top-4 right-4 bg-yellow-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';<br>            messageDiv.innerHTML = `<br>                <div class="flex items-center"><br>                    <i class="fas fa-info-circle ml-2"></i><br>                    <span>${message}</span><br>                </div><br>            `;<br>            document.body.appendChild(messageDiv);<br>            <br>            setTimeout(() => {<br>                messageDiv.remove();<br>            }, 4000);<br>        }<br><br>        // Initialize<br>        document.addEventListener('DOMContentLoaded', function() {<br>            // Check Firebase connection<br>            setTimeout(checkFirebaseConnection, 1000);<br>            <br>            // Load saved data from localStorage as fallback<br>            loadDataFromStorage();<br>            <br>            // Set current date for evaluation and issue dates<br>            const today = new Date().toISOString().split('T')[0];<br>            document.getElementById('evaluationDate').value = today;<br>            document.getElementById('issueDate').value = today;<br>        });<br>    </script><br><script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98e6bb65d58d9355',t:'MTc2MDQ0MTI5NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body><br></html></body></html>